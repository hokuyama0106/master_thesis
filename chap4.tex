\chapter{モジュール情報及び品質試験結果管理システム}
前章で述べたように、モジュール量産及び品質試験を世界中で行う。
これらの情報はデータベースシステムを用いて管理することが決まっていて、現在このシステムの開発を行っている。
システムについては、大きく2つに分けられる。
チェコに設置し、試験運用をしている中央データベースと、各組み立て期間に設置し、運用の際に使用するローカルデータベースである。
本章ではこれらのデータベースについて説明する。また、システム開発の中で私が開発を行った仕組みや機能について詳細に説明する。

\section{中央データベース}
\subsection{中央データベースの概要}
\subsubsection{概要}
中央データベースは、新型内部飛跡検出器の製造に関する全ての情報の保存を目的として開発されたデータベースである。
ユニコーン大学が開発、保守を行っていて、チェコにデータベースサーバーが設けられている。
新型内部飛跡検出器は、前述したようにピクセル検出機とストリップ検出機にから構成される。
これらを製造するにあたって、シリコンセンサーや電気基板といった小さな要素のものから製造を行い、それらの構成要素を用いたモジュールの組み立て、複数モジュールを搭載したステーブの組み立て等といった過程を経て検出機が完成する。
また各組み立て段階において、動作確認等を目的とした品質試験を行う。
これらの過程における全ての構成部品の情報、及び品質試験結果を中央データベースに保存する。

\subsubsection{意義}
中央データベースに保存された情報は、検出機運転時の参考値として扱われる。
モジュールを例にだすと、品質試験で読み出し試験を行った際の最適な設定値を中央データベースに保存するため、実際の運転時に参照することができる。
また運転前の状態における検出器の性能、運転前後での検出機性能比較を行うことができる。
HL-LHCでは1章で述べたように、運転時における放射線量が大きいものとなるため、運転前後での放射線損傷の影響の研究を行うことができ、検出機の寿命の推定や放射線損傷に関しての対策に役に立てることができる。

なんかデータが欲しいなあ。

\subsection{モジュール情報構造および構成部品との関係の実装}
中央データベースにモジュールを登録するためには、1章で述べたようにQuadやTripletといったモジュールの種類、Pull up resistorといった付随情報、モジュールを構成する部品などのモジュールの情報構造を決定し、データベース上に定義しておく必要がある。この情報構造をデータベースに実装し、登録できる仕組みを整えた。
詳細な構造については図?に示す。


また試験として、日本で作られている7台のモジュールを登録した。すべてのモジュールを正常に登録することができた。登録したモジュールの一覧を表?に示す。


\subsection{組み立て工程および品質試験の情報形式の実装}
モジュールの情報構造の実装に加えて、品質試験の情報を正確に管理するには、モジュール組み立て工程の情報と付随する品質試験の項目をデータベース上に定義する必要がある。これを実装し、テスト結果を適切な組み立て工程へアップロードできる仕組みを整えた。

詳細な構造を図?に示す。

\section{ローカルデータベース}
\subsection{ローカルデータベースの概要と意義}
中央データベースでは、前述したようにモジュールの情報のみならず新型内部飛跡検出器に関わるすべての情報を管理する。データベースの機能としては汎用的に使えるようなものになっている。
モジュールの組み立て及びその品質試験に関しては3章で述べたように工程が複数に渡り、行う品質試験の数も多い。また1つの生産現場で何千ものモジュールをつくことになるため、データ管理が簡単にかつ円滑に進むようになっているのが好ましい。
このような理由から、生産現場での生産性、利便性に特化し、円滑な生産をサポートすることを目的としたデータベースシステム(ローカルデータベース)を開発している。
システムの概要図を図?に示す。オープンソースのサービスであるMongoDBを各生産現場で使い、開発したウェブアプリケーションを併用することでデータ管理や中央データベースとのデータ同期を行うシステムとなっている。

具体的にローカルデータベースは以下のような利点を持つ。

\begin{itemize}
  \item ローカルにデータベースサーバーを立てるため、円滑にデータ管理を行うことができる。
  \item モジュールの組み立て工程を管理し、生産者の適切な処理を助ける。
  \item モジュールに特化したデータ管理、解析を行うことで異常をいち早く検知できる。
  \item 試験者の情報や試験時間など、テスト結果以外の必要な情報を正確に管理できる。
\end{itemize}


\subsection{MongoDBとその内部構造}
MongoDBの内部構造について簡単に図?に示す。

モジュール及び品質試験に関する構造として、表?にまとめた。

\subsection{中央データベースとの情報同期ツール}
生産時にはローカルデータベースと中央データベースにおいて、情報の同期が必要となる。例えば、モジュールのIDや組み立て工程、テスト結果といった情報があげられる。
この情報同期のためのインターフェースツールを開発した。主に開発した項目については以下の2つである。概念図を図?にまとめる。
\begin{itemize}
  \item モジュールのID及びモジュールを構成するFE chipのIDのダウンロード機能
  \item 品質試験の中の読み出し試験に関しての試験結果アップロード機能
\end{itemize}

ダウンロード機能についての詳細を図?にまとめた。中央データベースに登録されているモジュールの ID、FE chipのIDとその数、対応関係をダウンロードしてくるものとなる。


アップロード機能についての詳細を図?にまとめた。YARRで取得されるデータはFE chipごとであるため、取得ファイルはFE chipごとにアップロードすることとしている。


生産の際には、これら機能は後述するウェブアプリケーションを通して使用する。具体的な使用方法については、4.2.4節で述べる。処理速度に関する性能評価を5章で述べる。



\subsection{情報管理アプリケーション}
\subsubsection{概要、意義}
各組み立て機関において、試験者が品質試験結果を閲覧、管理するツールとして、ウェブアプリケーションを開発した。
試験結果を迅速に分かりやすく見るシステムを作り、円滑な生産の補助や異常結果の早期発見を目的としている。
アプリケーションの機能として、具体的に以下のような項目を実装している。

\begin{itemize}
  \item 登録モジュール及び品質試験結果の情報閲覧機能
  \item 登録モジュール及び品質試験結果の検索機能
  \item 試験者情報の管理及び各種機能
  \item 中央データベースへアップロードする品質試験結果の登録と組み立て工程の管理機能
  \item 中央データベースとのデータ同期機能
\end{itemize}

それぞれの機能の詳細を以下に記す。

\subsubsection{登録モジュール及び品質試験結果の情報閲覧}
アプリケーションを用いて、登録したモジュール情報やアップロードした結果を閲覧することができる。
あるモジュールに関しての情報を図?に、読み出し試験の結果を図?に示す。

\subsubsection{登録モジュール及び品質試験結果の検索機能}
登録モジュールや品質試験結果の一覧ページに検索機能を実装した。
確認したいモジュール情報や試験結果を迅速に取得し、閲覧できることを目的としている。検索を実装している様子を図?に示す。
一般的なウェブページの検索エンジンのように扱うことができる。

また生産に向けて、検索にかかる処理速度についての性能評価を行った。これについては6章で詳細を述べる。

\subsubsection{試験者情報の管理及び各種機能}

異常があった際に確認することを目的として、誰が試験を行ったかを記録することが必要である。
また、モジュールの登録や中央データベースとのデータ同期など、データベースの機能使用を制限することも必要である。
これらを目的として、試験者及びデータベース使用者情報の管理システムを開発、実装した。
この機能の概要について図?に示す。
データベースの管理者が試験者を登録することができる。また以下のような機能が登録試験者に制限される。

\begin{itemize}
  \item 試験結果のアップロード
  \item 中央データベースへアップロードする品質試験結果の登録と組み立て工程の管理機能
  \item 中央データベースとのデータ同期機能
\end{itemize}

上記の他に、登録ユーザは結果に対するコメント機能、任意のタグを貼る機能を使用することができる。各種機能について、使用したときの様子を図?に示す。

\subsubsection{中央データベースへアップロードする品質試験結果の登録と組み立て工程の自動更新}
ローカルデータベースへアップロードした品質試験結果の中から、本結果として中央データベースへアップロードする結果を選択する機能を開発した。
品質試験は3章で述べたように、各モジュール、各組み立て工程に対して行うものであるため、結果選択も同様に工程毎に行うことを想定している。
結果選択後、データベースにおける組み立て工程の情報も次のものへ自動的に更新する機能となっている。

あるモジュール、組み立て工程に対して結果を選択する様子を図?に示す。組み立て工程も自動更新されていることがわかる。

\subsubsection{中央データベースとのデータ同期機能}
4.2.3節で述べたモジュールのダウンロード機能、読み出し試験結果のアップロード機能をアプリケーションの中で使うことができる仕組みを実装した。

実際に機能を使ったときの様子を図?に示す。


\section{量産時の情報登録・同期の流れ}
QCの時に想定される情報のflowを書きます。module登録, download, 試験, 結果をpdにuploadといった流れ。

\section{モジュール量産情報確認解析}
将来的に、モジュールの量産がどこまで進んでいるかという解析を行うことを想定している。

